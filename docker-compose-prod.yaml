services:

  # Database service
  # This service uses MySql as the database for anything
  # that needs to be stored long-term. A volume is
  # mounted to the database service to ensure that the
  # data is persisted even if the container is removed.
  database:
    image: mysql:latest
    restart: always
    env_file:
      - path: stack.env
        required: false
    volumes:
      - database-volume:/var/lib/mysql
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
      interval: 5s
      timeout: 5s
      retries: 5

  # Bot service
  # This service is the main service that runs the bot.
  # It is built from the Dockerfile in the current directory
  # and has the PYTHONPATH environment variable set to
  # /opt/bot. The bot service depends on the database
  # service to be up and running before it starts.
  bot:
    build: .
    pull_policy: build
    restart: always
    environment:
      - PYTHONPATH=/opt/bot
    depends_on:
      database:
        condition: service_healthy
    env_file:
      - stack.env
volumes: 
  database-volume:
networks:
  farm_bot:
    driver: bridge